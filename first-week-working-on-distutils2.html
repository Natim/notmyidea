<!DOCTYPE HTML>
<html>
<head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <link rel="stylesheet" href="./theme/css/main.css" type="text/css" media="screen" charset="utf-8">
        <link href="./feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Alexis' log ATOM Feed" />
    <title>Alexis Métaireau</title>
</head>
<body>
    <div id="top">
        <p class="author"><a href=".">Alexis Métaireau</a>'s thougths</p>
        <ul class="links"></ul>
    </div>
    <div class="content clear">
    <h1>first week working on distutils2</h1>
    <p class="date">Published on Fri 04 June 2010</p>
    <p>As I've been working on
<a class="reference external" href="http://hg.python.org/distutils2/">Distutils2</a> during the past
week, taking part of the
<a class="reference external" href="http://code.google.com/intl/fr/soc/">GSOC</a> program, here is a
short summary of what I've done so far.</p>
<p>As my courses are not over yet, I've not worked as much as I
wanted, and this will continues until the end of June. My main
tasks are about making installation and uninstallation commands, to
have a simple way to install distributions via
<a class="reference external" href="http://hg.python.org/distutils2/">Distutils2</a>.</p>
<p>To do this, we need to rely on informations provided by the Python
Package Index (<a class="reference external" href="http://pypi.python.org/">PyPI</a>), and there is at
least two ways to retreive informations from here: XML-RPC and the
&quot;simple&quot; API.</p>
<p>So, I've been working on porting some
<a class="reference external" href="http://bitbucket.org/tarek/distribute/">Distribute</a> related
stuff to <a class="reference external" href="http://hg.python.org/distutils2/">Distutils2</a>, cutting
off all non distutils' things, as we do not want to depend from
Distribute's internals. My main work has been about reading the
whole code, writing tests about this and making those tests
possible.</p>
<p>In fact, there was a need of a pypi mocked server, and, after
reading and introducing myself to the distutils behaviors and code,
I've taken some time to improve the work
<a class="reference external" href="http://bitbucket.org/konrad">Konrad</a> makes about this mock.</p>
<div class="section" id="a-pypi-server-mock">
<h2>A PyPI Server mock</h2>
<p>The mock is embeded in a thread, to make it available during the
tests, in a non blocking way. We first used
<a class="reference external" href="http://wsgi.org">WSGI</a> and
<a class="reference external" href="http://docs.python.org/library/wsgiref.html">wsgiref</a> in order
control what to serve, and to log the requests made to the server,
but finally realised that
<a class="reference external" href="http://docs.python.org/library/wsgiref.html">wsgiref</a> is not
python 2.4 compatible (and we <em>need</em> to be python 2.4 compatible in
Distutils2).</p>
<p>So, we switched to
<a class="reference external" href="http://docs.python.org/library/basehttpserver.html">BaseHTTPServer</a>
and
<a class="reference external" href="http://docs.python.org/library/simplehttpserver.html">SimpleHTTPServer</a>,
and updated our tests accordingly. It's been an opportunity to
realize that <a class="reference external" href="http://wsgi.org">WSGI</a> has been a great step
forward for making HTTP servers, and expose a really simplest way
to discuss with HTTP !</p>
<p>You can find
<a class="reference external" href="http://bitbucket.org/ametaireau/distutils2/changesets">the modifications I made</a>,
and the
<a class="reference external" href="http://bitbucket.org/ametaireau/distutils2/src/tip/docs/source/test_framework.rst">related docs</a>
about this on
<a class="reference external" href="http://bitbucket.org/ametaireau/distutils2/">my bitbucket distutils2 clone</a>.</p>
</div>
<div class="section" id="the-pypi-simple-api">
<h2>The PyPI Simple API</h2>
<p>So, back to the main problematic: make a python library to access
and request information stored on PyPI, via the simple API. As I
said, I've just grabbed the work made from
<a class="reference external" href="http://bitbucket.org/tarek/distribute/">Distribute</a>, and played
a bit with, in order to view what are the different use cases, and
started to write the related tests.</p>
</div>
<div class="section" id="the-work-to-come">
<h2>The work to come</h2>
<p>So, once all use cases covered with tests, I'll rewrite a bit the
grabbed code, and do some software design work (to not expose all
things as privates methods, have a clear API, and other things like
this), then update the tests accordingly and write a documentation
to make this clear.</p>
<p>Next step is to a little client, as I've
<a class="reference external" href="http://github.com/ametaireau/pypiclient">already started here</a>
I'll take you updated !</p>
</div>


    
    <div class="comments">
    <h2>Comments</h2>
        <div id="disqus_thread"></div>
        <script type="text/javascript">
           var disqus_identifier = "first-week-working-on-distutils2.html";
           (function() {
           var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
           dsq.src = 'http://blog-notmyidea.disqus.com/embed.js';
           (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
    </div>
    
</div>
</body>
</html>